-- Create dedicated warehouse for different groups and assigned users per role

```sql
--Create virtual warehouse
CREATE OR REPLACE WAREHOUSE GL_WH
WITH
WAREHOUSE_SIZE = 'SMALL'
WAREHOUSE_TYPE = 'STANDARD' 
AUTO_SUSPEND = 300 
AUTO_RESUME = TRUE 
MIN_CLUSTER_COUNT = 1 
MAX_CLUSTER_COUNT = 1 
SCALING_POLICY = 'STANDARD';

ALTER WAREHOUSE GL_WH SET WAREHOUSE_SIZE = 'XSMALL';

CREATE OR REPLACE WAREHOUSE EDW_WH
WITH
WAREHOUSE_SIZE = 'XSMALL'
WAREHOUSE_TYPE = 'STANDARD' 
AUTO_SUSPEND = 300 
AUTO_RESUME = TRUE 
MIN_CLUSTER_COUNT = 1 
MAX_CLUSTER_COUNT = 1 
SCALING_POLICY = 'STANDARD';

--Create role
CREATE ROLE GL_ROLE;
CREATE ROLE EDW_ROLE;

--Grant role on Warehouse
GRANT USAGE ON WAREHOUSE GL_WH TO ROLE GL_ROLE;
GRANT USAGE ON WAREHOUSE EDW_WH TO ROLE EDW_ROLE;

--Create Users
CREATE USER GL_USER PASSWORD = 'GL_USER' LOGIN_NAME = 'GL_USER' DEFAULT_ROLE='GL_ROLE' DEFAULT_WAREHOUSE = 'GL_WH'  MUST_CHANGE_PASSWORD = FALSE;
CREATE USER EDW_USER PASSWORD = 'EDW_USER' LOGIN_NAME = 'EDW_USER' DEFAULT_ROLE='EDW_ROLE' DEFAULT_WAREHOUSE = 'EDW_WH'  MUST_CHANGE_PASSWORD = FALSE;

--Grant Roles to Users
GRANT ROLE GL_ROLE TO USER GL_USER;
GRANT ROLE EDW_ROLE TO USER EDW_USER;

--Drop objects
DROP USER IF EXISTS GL_USER;
DROP USER IF EXISTS EDW_USER;

DROP ROLE IF EXISTS GL_ROLE;
DROP ROLE IF EXISTS EDW_ROLE;

DROP WAREHOUSE IF EXISTS GL_WH;
DROP WAREHOUSE IF EXISTS EDW_WH;
```

```sql
--=================================================================
-- Cloud Integration - GCP
--=================================================================

    CREATE OR REPLACE DATABASE GCP_INTEGRATION_DB;

    CREATE OR REPLACE SCHEMA GCP_INTEGRATION_DB.GCP;

    CREATE OR REPLACE STORAGE INTEGRATION GCP_INTEGRATION
        TYPE=EXTERNAL_STAGE
        STORAGE_PROVIDER = GCS
        ENABLED = TRUE
        STORAGE_ALLOWED_LOCATIONS = ('gcs://pjaiswal-snowflake-bucket-gcp/3/csv/');

    DESC STORAGE INTEGRATION GCP_INTEGRATION;

    ---
    -- Take STORAGE_GCP_SERVICE_ACCOUNT
    -- In GCP IAM, Create Role and for bucket, allow principle to this role with STORAGE_GCP_SERVICE_ACCOUNT
    ---

    CREATE OR REPLACE FILE FORMAT GCP_INTEGRATION_DB.GCP.GCP_FILE_FORMAT
        TYPE='CSV'
        FIELD_DELIMITER=',',
        SKIP_HEADER=1;
        
    
    CREATE OR REPLACE STAGE GCP_INTEGRATION_STAGE_LOAD
      URL = 'gcs://pjaiswal-snowflake-bucket-gcp/3/csv/'
      STORAGE_INTEGRATION = GCP_INTEGRATION
      FILE_FORMAT = GCP_INTEGRATION_DB.GCP.GCP_FILE_FORMAT;

    LIST @GCP_INTEGRATION_STAGE_LOAD;

    
    CREATE OR REPLACE TABLE EMPLOYEE (
        customer_id integer,
        first_name varchar(50),
        last_name varchar(50),
        email varchar(50),
        location varchar(50),
        department varchar(50)
    );

    COPY INTO EMPLOYEE
    FROM @GCP_INTEGRATION_STAGE_LOAD
    FILE_FORMAT = GCP_INTEGRATION_DB.GCP.GCP_FILE_FORMAT
    files=('employee_data_1.csv')
    VALIDATION_MODE=RETURN_ERRORS;

    COPY INTO EMPLOYEE
    FROM @GCP_INTEGRATION_STAGE_LOAD
    FILE_FORMAT = GCP_INTEGRATION_DB.GCP.GCP_FILE_FORMAT
    files=('employee_data_1.csv')
    ON_ERROR=SKIP_FILE
    TRUNCATECOLUMNS=TRUE;

    SELECT * FROM EMPLOYEE;
    
    
    CREATE OR REPLACE STAGE GCP_INTEGRATION_STAGE_UNLOAD
      URL = 'gcs://pjaiswal-snowflake-bucket-gcp/3/csv/unload'
      STORAGE_INTEGRATION = GCP_INTEGRATION
      FILE_FORMAT = (TYPE='CSV' FIELD_DELIMITER=',' SKIP_HEADER=0);

    COPY INTO @GCP_INTEGRATION_STAGE_UNLOAD FROM EMPLOYEE;


    

```







